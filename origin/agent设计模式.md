202510142119
Status: #idea
Tags: [[AI赋能]]

# agent设计模式核心知识点总结


**导言：从“聊天”到“思考”的转变**

本文档旨在完整、精确地总结`agentic-design-patterns-cn`项目中的核心知识点。经过深度研读，我们必须认识到，Agent的核心价值不在于“回答”问题，而在于“解决”问题。这些设计模式，正是赋予AI**从被动应答进化到主动思考和行动能力**的关键蓝图。

### **一、核心设计原则 (Guiding Principles)**

在深入学习21种具体模式之前，我们必须先掌握构建高效Agent的四大元原则。它们是所有模式背后的思想精髓。

1. **清晰胜于聪慧** (Clarity **over Cleverness)**
    
    - **原则**: 给予Agent的指令（Prompt）、工具描述和示例必须是**极度清晰、明确、无歧义**的。不要假设Agent能“猜到”你的意图。一个啰嗦但清晰的指令，远胜于一个简短但模糊的指令。
    - **应用**: 在我们的提示词工程中，必须用详尽的语言描述人格、任务和安全边界。
        
2. **结构决定行为 (Structure Dictates Behavior)**
    
    - **原则**: Agent的行为很大程度上由你提供给它的结构所决定。这包括Prompt的结构、输出格式的结构（如要求输出JSON）、以及工具的结构。
    - **应用**: 我们要求Agent在生成TTS语音时输出情感标签`[happy]`，这就是通过结构来规范其行为，使其输出能被下游系统（TTS引擎）稳定处理。
        
3. **万物皆为工具 (Everything is a Tool)**
    
    - **原则**: 不要试图用一个巨大的Prompt教会LLM所有事。应该将每一个外部能力（查询数据库、调用API、甚至复杂的内部计算）都封装成一个**定义清晰的工具**，让Agent在需要时自主调用。
    - **应用**: 我们的“记忆仓储库”不应只是被动检索，而应被封装成`search_memory`和`delete_memory`等工具，供Agent主动使用。
        
4. **迭代与评估是唯一通路 (Iteration & Evaluation is the Only Way)**
    
    - **原则**: 不存在一步到位的完美Agent。唯一成功的路径是：**构建 -> 评测 -> 分析 -> 改进 -> 再构建**的闭环。
    - **应用**: 这正是我们“双轨制”开发流程和“V1版评测体系”的核心思想。
        

### **二、核心设计模式详解 (21种模式)**

#### **类别一：基础构建模块 (Core Patterns)**

|   |   |   |   |
|---|---|---|---|
|**模式**|**核心思想**|**核心机制**|**在“AI私密伴侣”中的应用场景**|
|**1. 提示链**|**任务分解**|将复杂任务拆解为多个LLM调用，前一步的输出作为后一步的输入。|用户抱怨工作压力大，可分解为：“1.识别核心情绪 -> 2.共情并安抚 -> 3.提供具体建议”。|
|**2. 路由**|**决策制定**|通过一个“路由”LLM或关键词匹配，根据用户意图，决定下一步调用哪个提示链或工具。|识别用户是在“闲聊”还是寻求“情感教练”服务，并加载不同的Prompt和工具集。|
|**3. 工具使用**|**能力扩展**|赋予LLM调用外部API或内部函数的能力，以获取实时信息或执行操作。|调用`P0-MV-02`记忆删除工具、`P1-EB-01`危机干预工具、天气API等。|
|**4. 规划**|**多步执行**|让LLM面对复杂目标时，自主制定一个包含多个步骤的计划，然后逐一执行。|用户说“帮我计划一个放松的周末”，Agent可以规划出“1.调用电影API -> 2.调用地图API查公园 -> 3.整合信息”的计划。|
|**5. 反思**|**自我纠错**|让LLM审查和评估自己生成的回复或计划，并对其进行批判性地改进。|V2阶段探索的“**反射-修正**”机制(`C-1+`)，用于解决“人设不崩”问题。|
|**6. 并行化**|**效率提升**|当任务可分解为多个独立子任务时，同时执行它们，以缩短总响应时间。|用户同时问天气和新闻时，后端可**异步并行**调用两个API，然后汇总结果。|
|**7. 多智能体**|**团队协作**|构建由多个拥有不同“专长”的Agent组成的系统，它们协同完成宏大目标。|在评测体系中，让一个Agent扮演“挑剔用户”，一个扮演“产品经理”，共同评估回复。|

#### **类别二：高级智能与适应性 (Advanced Patterns)**

|   |   |   |   |
|---|---|---|---|
|**模式**|**核心思想**|**核心机制**|**在“AI私密伴侣”中的应用场景**|
|**8. 记忆管理**|**经验积累**|设计短期（对话历史）、长期（RAG）、实体（用户画像）等多种记忆机制。|产品的**最核心部分**。通过RAG实现的“记忆仓储库”(`F-3`)就是该模式的直接应用。|
|**9. 学习与适应**|**持续进化**|让Agent能从新的数据或用户反馈（如点踩）中学习，并更新其行为或知识库。|我们的“**动态评测集**”机制，即从用户“点踩”的坏案例中学习并迭代。|
|**10. MCP**|**标准化交互**|建立一个标准化的交互协议，定义Agent、LLM、工具之间的数据结构和通信方式。|后端`AgentService`定义的`RequestContext`和响应流，以及它与`ChatModel`、`MemoryStore`的接口，就是一种MCP。|
|**11. 目标设定**|**目的导向**|赋予Agent设定、追踪和动态调整其长期或短期目标的能力。|在“情感教练”(`P1-EC-01`)模式中，为用户设定“提升情绪调节能力”的长期目标，Agent会持续围绕此目标引导对话。|

#### **类别三：人机与系统交互 (Integration Patterns)**

|   |   |   |   |
|---|---|---|---|
|**模式**|**核心思想**|**核心机制**|**在“AI私密伴侣”中的应用场景**|
|**12. RAG**|**知识赋能**|在生成回复前，先从知识库中检索相关信息，作为LLM的上下文。|“记忆仓储库”(`F-3`)和“情感教练”的专业知识库(`P1-EC-01`)都是通过RAG实现的。|
|**13. 人机协作**|**引入人类智慧**|在关键决策点或Agent无法处理时，引入人类进行审核、修正或决策。|“反射-修正”机制的MVP替代方案——“**人机协作质检系统**”。|
|**14. 异常处理**|**鲁棒性保障**|定义当工具调用失败、API超时或LLM返回错误时，Agent如何优雅地处理并恢复。|天气API调用失败时，Agent应回复：“抱歉，我暂时查不到天气了，不如聊点别的？”|

#### **类别四：生产环境部署与安全 (Production Patterns)**

|   |   |   |   |
|---|---|---|---|
|**模式**|**核心思想**|**核心机制**|**在“AI私密伴侣”中的应用场景**|
|**15. 护栏/安全**|**风险控制**|建立一套规则或模型，作为Agent行为的边界，防止其生成不当内容。|“**区域化内容安全护栏**”(`P-1`)和“**危机干预机制**”(`P1-EB-01`)。|
|**16. 评估与监控**|**质量保障**|建立系统性的、自动化的评测体系，持续监控Agent的性能和质量。|我们的“**V1版评测体系**”(`F-4`)，包括黄金评测集和自动化回归测试。|
|**17. 资源感知**|**成本控制**|让Agent或框架能感知计算资源（如Token）的消耗，并根据预算进行优化。|“**模型网关**”(`F-2`)中的“任务路由”策略（简单任务用廉价模型）。|
|**18. A2A通信**|**Agent间协作**|定义多个Agent之间通信和协作的协议，使它们能够共享信息、分配任务。|V2阶段，可设想“主伴侣Agent”与“日程规划Agent”通信，为用户安排活动。|
|**19. 推理技术**|**深度思考**|增强Agent的逻辑推理能力，如使用思维链（CoT），使其能进行更深入的思考。|当用户提出复杂情感困境时，Agent可内部使用CoT进行推理：“1.分析原因 -> 2.评估利弊 -> 3.构思方案 -> 4.给出建议”。|
|**20. 优先级排序**|**任务调度**|当Agent面临多个任务时，建立机制决定哪个任务应该被优先执行。|当Agent同时收到普通聊天和“危机干预”警报时，此模式确保它必须**立即**处理危机警报。|
|**21. 探索与发现**|**自主学习**|赋予Agent自主探索新信息、学习新技能的能力，而非仅被动执行任务。|V2阶段，允许Agent主动浏览安全审核过的新闻网站，当发现用户可能感兴趣的文章时，主动分享。|

### **三、战略应用：如何运用设计模式构建AI私密伴侣**

掌握这些模式后，我们可以为我们的开发总纲制定一个更清晰的、基于模式的演进路线图。

#### **MVP阶段 (P0) 重点模式：构建可靠的基础**

- **核心**: `RAG` + `工具使用` + `路由`
- **保障**: `护栏/安全` + `评估与监控` + `资源感知`
- **解释**: MVP阶段的核心是搭建一个**可靠且高效的对话基础**。我们必须能准确地**检索**记忆(RAG)，可靠地**执行**操作(工具使用)，智能地**分发**任务(路由)，同时保证产品是**安全**的(护栏)、**可衡量**的(评估)和**可盈利**的(资源感知)。
    

#### **V2阶段 (P1/P2) 引入模式：注入“智能”与“生命感”**

- **核心**: `反思` + `规划` + `学习与适应` + `目标设定`
- **扩展**: `多智能体` + `A2A通信` + `探索与发现`
- **解释**: 在基础可靠之后，V2阶段的目标是让Agent**真正“活”起来**。它需要能**自我纠错**(反思)，能**制定计划**(规划)，能从用户反馈中**成长**(学习)，并有自己的**目标**(目标设定)，甚至能与其他Agent**协作**(多智能体)，并**主动探索**世界(探索与发现)。
    

通过这个分阶段的、基于设计模式的路线图，我们可以确保团队在每个阶段都聚焦于最核心的任务，稳步地将“AI私密伴


---
# References
> https://github.com/ginobefun/agentic-design-patterns-cn