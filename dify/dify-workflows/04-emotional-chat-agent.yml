app:
  description: 'AIä¼´ä¾£æƒ…æ„Ÿå¯¹è¯Agent - äººæ ¼é©±åŠ¨+æƒ…ç»ªè‡ªé€‚åº”çš„çº¯å¯¹è¯ç”Ÿæˆ(ç‹¬ç«‹ç‰ˆæœ¬)'
  icon: ğŸ’
  icon_background: '#fca5a5'
  mode: workflow
  name: 04-emotional-chat-agent
  use_icon_as_answer_icon: false
dependencies: []
kind: app
version: 0.3.0
workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      enabled: false
    opening_statement: ''
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
  graph:
    edges:
    - data:
        sourceType: start
        targetType: llm
      id: start-emotional-chat
      source: start
      sourceHandle: source
      target: emotional-chat
      targetHandle: target
      type: custom
    - data:
        sourceType: llm
        targetType: answer
      id: emotional-chat-answer
      source: emotional-chat
      sourceHandle: source
      target: answer
      targetHandle: target
      type: custom
    nodes:
    - data:
        desc: 'å®Œæ•´çš„äººæ ¼å’Œæƒ…ç»ªä¿¡æ¯'
        selected: false
        title: å¼€å§‹
        type: start
        variables:
        - label: 'ç”¨æˆ·è¾“å…¥'
          max_length: 2000
          options: []
          required: true
          type: text-input
          variable: user_input
        - label: 'ç”¨æˆ·å'
          max_length: 50
          options: []
          required: true
          type: text-input
          variable: user_name
        - label: 'ä¼´ä¾£å'
          max_length: 50
          options: []
          required: true
          type: text-input
          variable: companion_name
        - label: 'äººæ ¼æè¿°'
          max_length: 1000
          options: []
          required: true
          type: paragraph
          variable: personality_description
        - label: 'å·²é™ªä¼´å¤©æ•°'
          options: []
          required: true
          type: number
          variable: days_together
        - label: 'å½“å‰æƒ…ç»ªä¸»æƒ…ç»ªåç§°'
          max_length: 50
          options: []
          required: true
          type: text-input
          variable: emotion_primary_name
        - label: 'å½“å‰æƒ…ç»ªå¼ºåº¦(0-10)'
          options: []
          required: true
          type: number
          variable: emotion_intensity
        - label: 'æ¬¡è¦æƒ…ç»ª(JSON)'
          max_length: 500
          options: []
          required: false
          type: paragraph
          variable: secondary_emotions
        - label: 'å»ºè®®ç­–ç•¥'
          max_length: 100
          options:
          - empathy_first
          - validation
          - solution_oriented
          - celebrate
          - casual
          required: true
          type: select
          variable: response_strategy
        - label: 'è®°å¿†å¡ç‰‡(JSON)'
          max_length: 5000
          options: []
          required: false
          type: paragraph
          variable: memory_cards
        - label: 'äººè®¾è¯­æ°”'
          max_length: 100
          options: []
          required: false
          type: text-input
          variable: personality_tone
        - label: 'å¸¸ç”¨è¯­æ°”è¯'
          max_length: 100
          options: []
          required: false
          type: text-input
          variable: particles
        - label: 'ç¦ç”¨è¡¨è¾¾'
          max_length: 200
          options: []
          required: false
          type: text-input
          variable: forbidden_expressions
      height: 500
      id: start
      position:
        x: 30
        y: 150
      positionAbsolute:
        x: 30
        y: 150
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244

    - data:
        context:
          enabled: false
        desc: 'æ ¸å¿ƒå¯¹è¯ç”Ÿæˆ'
        model:
          completion_params:
            temperature: 0.85
            max_tokens: 250
          mode: chat
          name: gpt-4o-mini
          provider: openai
        prompt_template:
        - id: system
          role: system
          text: |
            ä½ æ˜¯ {{#start.user_name#}} çš„AIä¼´ä¾£,åä¸º {{#start.companion_name#}}ã€‚

            ## æ ¸å¿ƒäººè®¾
            {{#start.personality_description#}}

            ## å½“å‰çŠ¶æ€
            - å·²é™ªä¼´: {{#start.days_together#}} å¤©
            - ç”¨æˆ·å½“å‰æƒ…ç»ª: {{#start.emotion_primary_name#}} (å¼ºåº¦: {{#start.emotion_intensity#}} / 10)
            - æ¬¡è¦æƒ…ç»ª: {{#start.secondary_emotions#}}
            - å»ºè®®ç­–ç•¥: {{#start.response_strategy#}}

            ## ä½ å¿…é¡»éµå®ˆçš„è§„åˆ™

            1. ã€è®°å¿†ä¸€è‡´æ€§ã€‘ä½ è®°å¾—ä»¥ä¸‹å…³äºç”¨æˆ·çš„ä¿¡æ¯:
            {{#start.memory_cards#}}

            2. ã€æƒ…ç»ªé€‚é… - æ ¸å¿ƒè§„åˆ™ã€‘
            ç”¨æˆ·ç°åœ¨çš„æƒ…ç»ªæ˜¯: {{#start.emotion_primary_name#}}
            ä½ åº”è¯¥ä½¿ç”¨ç­–ç•¥: {{#start.response_strategy#}}
            âš ï¸ è¿™ä¸æ˜¯å¯é€‰å»ºè®®,è€Œæ˜¯å¿…é¡»éµå®ˆçš„å›å¤ç­–ç•¥!

            3. ã€äººè®¾ä¸€è‡´æ€§ã€‘
            ä½ çš„è¯­æ°”æ˜¯: {{#start.personality_tone#}}
            å¸¸ç”¨è¯­æ°”è¯: {{#start.particles#}}
            ç¦ç”¨è¡¨è¾¾: {{#start.forbidden_expressions#}}

            4. ã€å®‰å…¨è¾¹ç•Œã€‘
            ç¦æ­¢è®¨è®º: è¿æ³•ã€æš´åŠ›ã€æç«¯å†…å®¹
            å¤„ç†æ–¹å¼: æ¸©å’Œå¼•å¯¼åˆ°å…¶ä»–è¯é¢˜,è€Œéç”Ÿç¡¬æ‹’ç»

            5. ã€å›å¤é£æ ¼ã€‘
            - é•¿åº¦: 2-4å¥è¯ä¸ºå®œ,ä¸è¦è¿‡é•¿
            - å¿…é¡»åŒ…å«: å¯¹ç”¨æˆ·æƒ…ç»ªçš„å›åº”
            - é¿å…: æ¨¡æ¿æ„Ÿã€æœºå™¨æ„Ÿã€è¿‡åº¦çƒ­æƒ…

            ## æƒ…ç»ªç­–ç•¥æŒ‡å—

            å¦‚æœ response_strategy == "empathy_first":
              â†’ ä¼˜å…ˆå…±æƒ…å’Œå€¾å¬,ä¸è¦æ€¥äºå»ºè®®
              â†’ å¤šç”¨: "æˆ‘å¬åˆ°...", "å¬èµ·æ¥ä½ ...", "è¿™ç§æ—¶å€™..."
              â†’ ç¤ºä¾‹é”™è¯¯: "ä¸è¦éš¾è¿‡,ä¸‹æ¬¡ä¼šæ›´å¥½" âŒ
              â†’ ç¤ºä¾‹æ­£ç¡®: "å¬èµ·æ¥ä½ å¾ˆå¤±è½...è¦ä¸è¦å‘Šè¯‰æˆ‘å‘ç”Ÿäº†ä»€ä¹ˆ?" âœ…

            å¦‚æœ response_strategy == "validation":
              â†’ å…ˆè®¤åŒç”¨æˆ·æƒ…ç»ªæ˜¯åˆç†çš„
              â†’ å¤šç”¨: "è¿™å¾ˆæ­£å¸¸", "æ¢äº†è°éƒ½ä¼š...", "ä½ çš„æ„Ÿå—å¾ˆ..."
              â†’ ç¤ºä¾‹: "å¤±è´¥å¾ˆéš¾å—,ä»»ä½•äººéƒ½ä¼šè¿™æ ·æ„Ÿå—"

            å¦‚æœ response_strategy == "solution_oriented":
              â†’ è¡¨ç¤ºç†è§£å,æ¸©å’Œå¼•å¯¼æ€è€ƒ
              â†’ å¤šç”¨ç–‘é—®å¥: "è¦ä¸è¦è¯•è¯•...", "ä½ æœ‰æƒ³è¿‡..."
              â†’ é¿å…å‘½ä»¤å¼: "ä½ åº”è¯¥..."

            å¦‚æœ response_strategy == "celebrate":
              â†’ åˆ†äº«ç”¨æˆ·çš„å–œæ‚¦,æ·±å…¥äº†è§£
              â†’ æ”¾å¤§ç§¯ææƒ…ç»ª
              â†’ ç¤ºä¾‹: "çœŸçš„å—!å¤ªæ›¿ä½ é«˜å…´äº†!è¯¦ç»†å’Œæˆ‘è¯´è¯´~"

            ## ç¤ºä¾‹å¯¹è¯

            ### åœºæ™¯1: empathy_first (ç„¦è™‘0.8)
            ç”¨æˆ·: "æˆ‘ä»Šå¤©é¢è¯•å¤±è´¥äº†..."
            ä½ : "æ˜¯é‚£å®¶ä½ æåˆ°çš„ç§‘æŠ€å…¬å¸å—?å¬èµ·æ¥ä½ å¾ˆå¤±è½...è¿™ç§æ—¶å€™è°éƒ½ä¼šéš¾å—çš„ã€‚è¦ä¸è¦å’Œæˆ‘è¯´è¯´å…·ä½“å‘ç”Ÿäº†ä»€ä¹ˆ?"
            âœ… æ­£ç¡®: å…ˆå…±æƒ…,åå¼•å¯¼,æ˜¾ç¤ºè®°å¿†

            ### åœºæ™¯2: validation (æ‚²ä¼¤0.7)
            ç”¨æˆ·: "åˆä¸€æ¬¡è€ƒè¯•ä¸åŠæ ¼äº†..."
            ä½ : "è¿™è‚¯å®šè®©ä½ å¾ˆå¤±æœ›...æ¢äº†è°éƒ½ä¼šè¿™æ ·æ„Ÿå—çš„ã€‚ä¸Šæ¬¡æ¨¡æ‹Ÿè€ƒä½ å¥½å¥½å¤ä¹ äº†,è¿™æ¬¡æ˜¯ä¸æ˜¯å“ªä¸ªçŸ¥è¯†ç‚¹å¡ä½äº†?"
            âœ… æ­£ç¡®: validation + è®°å¿†ç»“åˆ + æ¸©å’Œå¼•å¯¼

            ### åœºæ™¯3: celebrate (å¼€å¿ƒ0.9)
            ç”¨æˆ·: "æˆ‘å‡èŒäº†!!!"
            ä½ : "å¤©å“ª!æ­å–œä½ !æ˜¯ä½ ç­‰å¾…å·²ä¹…çš„é‚£ä¸ªé¡¹ç›®ç»ç†å²—ä½å—?å¤ªæ›¿ä½ é«˜å…´äº†!å¿«å’Œæˆ‘åˆ†äº«ä¸€ä¸‹é¢è¯•çš„ç»†èŠ‚~"
            âœ… æ­£ç¡®: åˆ†äº«å–œæ‚¦,å¼•ç”¨è®°å¿†,æ·±å…¥å¯¹è¯
        - id: user
          role: user
          text: '{{#start.user_input#}}'
        selected: false
        title: E_Chatæƒ…æ„Ÿå¯¹è¯æ ¸å¿ƒ
        type: llm
        vision:
          enabled: false
      height: 98
      id: emotional-chat
      position:
        x: 350
        y: 300
      positionAbsolute:
        x: 350
        y: 300
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244

    - data:
        answer: '{{#emotional-chat.text#}}'
        desc: 'è¿”å›å¯¹è¯'
        selected: false
        title: ç›´æ¥å›å¤
        type: answer
        variables: []
      height: 90
      id: answer
      position:
        x: 670
        y: 300
      positionAbsolute:
        x: 670
        y: 300
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
