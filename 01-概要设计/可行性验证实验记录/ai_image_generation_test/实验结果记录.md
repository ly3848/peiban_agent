# 实验五：AI 绘图 (Stable Diffusion) 风格一致性

## 实验目的

验证是否能通过简单的 Prompt（用户输入的关键词），稳定生成风格统一的 2D 二次元头像，而不是生成写实或崩坏的图片。

## 预期结果

- **可用率**: 生成 10 张图，至少 8 张五官端正、风格契合
- **速度**: < 15秒

## 实验配置

### API 配置

- **API 提供商**: 硅基流动 (SiliconFlow)
- **API Key**: sk-kxdeuhjyqhfohjzkbrelqhvsogxhvrrvzlrjxlliveclbqtu (已配置，不在此记录)
- **API URL**: https://api.siliconflow.cn/v1

### 测试环境

- **测试时间**: 2025-12-07 13:24-13:26
- **测试人员**: 自动化测试脚本
- **Python 版本**: Python 3.x
- **网络环境**: 
  - [x] 公司 WiFi
  - [ ] 4G 热点
  - [ ] 5G 热点
  - [ ] 其他: __________

## 实验步骤

1. ✅ 选择绘图 API (硅基流动)
2. ✅ 固定一套 Negative Prompt (反向提示词：nsfw, ugly, deformed...)
3. ✅ 输入测试 Prompt: 1girl, cute, pink hair, student uniform, anime style
4. ✅ 生成 10 次，观察一致性
5. ✅ 记录测试结果

## 实验结果记录

### 测试配置

**测试时间**: __________

**测试命令**:
```bash
python test_image_generation.py --api-key <API_KEY> --num-images 10 --output test_results.json
```

**提示词配置**:
- **正向提示词**: `1girl, cute, pink hair, student uniform, anime style`
- **反向提示词**: `nsfw, ugly, deformed, blurry, bad anatomy, bad proportions`
- **模型**: `black-forest-labs/FLUX.1-schnell`

---

### 生成速度测试

**测试结果**:

- [x] 平均生成时间: **2.5 秒** (2471 ms)
- [x] 最小生成时间: **2.0 秒** (1981 ms)
- [x] 最大生成时间: **3.9 秒** (3864 ms)
- [x] 成功率: **80.0%** (8/10，因速率限制有 2 次失败)
- [x] 评估: **优秀** (< 15秒)

**详细数据文件**: `test_results.json`, `test_results_part2.json`

**生成时间分布**:
- 第1批 (6张): 平均 2.5秒 (1981ms - 3864ms)
- 第2批 (2张): 平均 2.2秒 (2018ms - 2317ms)

---

### 图片质量评估（人工检查）

**生成图片目录**: `generated_images/`

**质量检查结果**:

| 图片编号 | 文件名 | 五官端正 | 风格契合 | 备注 |
|---------|--------|---------|---------|------|
| 1 | image_01_1765085086.png | ⏳ 待检查 | ⏳ 待检查 | |
| 2 | image_02_1765085090.png | ⏳ 待检查 | ⏳ 待检查 | |
| 3 | image_03_1765085094.png | ⏳ 待检查 | ⏳ 待检查 | |
| 4 | image_04_1765085097.png | ⏳ 待检查 | ⏳ 待检查 | |
| 5 | image_05_1765085101.png | ⏳ 待检查 | ⏳ 待检查 | |
| 6 | image_06_1765085106.png | ⏳ 待检查 | ⏳ 待检查 | |
| 7 | image_01_1765085158.png | ⏳ 待检查 | ⏳ 待检查 | |
| 8 | image_02_1765085162.png | ⏳ 待检查 | ⏳ 待检查 | |

**统计结果**:

- [ ] 符合要求的图片数量: ⏳ 待人工检查 / 8
- [ ] 可用率: ⏳ 待人工检查 %
- [ ] 评估: ⏳ 待人工检查

**注意**: 图片质量需要人工检查，请查看 `generated_images/` 目录中的图片进行评估。

---

## 综合评估

### 测试总结

| 测试项 | 结果 | 评估 |
|--------|------|------|
| 生成速度 | 2.5 秒 | ✓ 优秀 |
| 可用率 | ⏳ 待检查 / 8 | ⏳ 待检查 |
| 成功率 | 80.0% | ⚠️ 受速率限制影响 |

### 结论

- [x] **生成速度优秀**: 平均 2.5 秒，远低于 15 秒预期
- [ ] **可以直接上线**: 速度和可用率均符合预期（需等待质量检查结果）
- [ ] **需要预设 LoRA**: 风格一致性不足，需要使用 LoRA 模型
- [ ] **需要更换模型**: 当前模型效果不理想
- [ ] **需要优化 Prompt**: 提示词需要进一步优化
- [x] **其他**: 遇到 API 速率限制，建议增加请求间隔或升级 API 套餐

### 后续行动

1. __________
2. __________
3. __________

### 备注

```
测试结果说明：
- 模型: FLUX.1-schnell (快速版本)
- 成功生成 8 张图片（因 API 速率限制，有 2 次请求失败）
- 生成速度: 平均 2.5 秒，表现优秀
- 图片已保存在 generated_images/ 目录

遇到的问题：
- API 速率限制: 连续请求时触发 IPM (Images Per Minute) 限制
- 建议: 增加请求间隔（如 5-10 秒）或升级 API 套餐

模型选择建议：
- FLUX.1-schnell: 速度快，适合快速生成
- FLUX.1-dev: 质量可能更好，但速度较慢
- 可以尝试其他模型进行对比

Prompt 优化建议：
- 当前 Prompt 较为简单，可以尝试更详细的描述
- 可以添加更多风格关键词（如 "high quality", "detailed", "masterpiece"）
- 反向提示词可以更具体

改进方向：
1. 增加请求间隔，避免速率限制
2. 尝试不同的模型进行对比
3. 优化 Prompt 以获得更好的风格一致性
4. 考虑使用 LoRA 模型来固定风格
```

---

## 附录：测试数据文件

- `test_results.json`: 完整测试数据（JSON 格式）
- `generated_images/`: 生成的图片文件

